{% extends "base.html" %}
{% block content %}
<div class="container mt-4 mechanic-detail">
  <!-- Mechanic Header -->
  <div class="card shadow-sm p-4 mb-4 rounded-3">
    <h2 class="mb-2">{{ mechanic.service_center_name }}</h2>
    <p class="text-muted mb-1"><strong>Mechanic:</strong> {{ mechanic.user.username }}</p>
    <p class="mb-1"><strong>Phone:</strong> {{ mechanic.phone }}</p>
    <p class="mb-1"><strong>Location:</strong> {{ mechanic.location }}</p>
    
    <div class="rating-box mt-3">
      <h5>⭐ Average Rating: {{ avg_rating }} / 5</h5>
      <small>Based on {{ feedbacks|length }} reviews</small>
    </div>
  </div>
 
  <div id="map" style="height:300px;"></div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const lat = {{ mechanic.latitude|default:"0" }};
  const lng = {{ mechanic.longitude|default:"0" }};
  const m = L.map('map').setView([lat, lng], 14);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap contributors' }).addTo(m);
  L.marker([lat, lng]).addTo(m).bindPopup("{{ mechanic.service_center_name }}");
</script>


  <!-- Feedback List -->
  <div class="card shadow-sm p-4 rounded-3">
    <h4>User Feedback</h4>
    <hr>
    {% if feedbacks %}
      {% for fb in feedbacks %}
        <div class="feedback-card mb-3 p-3 border rounded">
          <div class="d-flex justify-content-between">
            <div>
              <strong>{{ fb.user.username }}</strong>
              <span class="badge bg-warning text-dark ms-2">{{ fb.rating }}⭐</span>
            </div>
            <small class="text-muted">{{ fb.created_at|date:"M d, Y H:i" }}</small>
          </div>
          <p class="mt-2 mb-0">{{ fb.comment }}</p>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-muted">No feedback available yet.</p>
    {% endif %}
  </div>

  <!-- Feedback Button -->
  {% if user.is_authenticated %}
    <div class="mt-3">
      <a href="{% url 'give_feedback' mechanic.id %}" class="btn btn-primary">
        Leave Feedback
      </a>
    </div>
  {% else %}
    <p class="mt-3 text-muted">Login to leave feedback.</p>
  {% endif %}
</div>
{% endblock %}
